@model AMRVI.ViewModels.DashboardViewModel

@{
    ViewData["Title"] = "Executive Dashboard";
}

@section Styles {
    <link rel="stylesheet" href="~/css/tv-display-fix.css" asp-append-version="true" />
}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div id="dashboardContainer" class="dashboard-viewport fade-in">
    <partial name="_DashboardContent" model="Model" />
</div>

<script>
    // Global function for SignalR automatic update
    // This function is called by _Layout.cshtml when "RefreshData" signal is received
    window.refreshDashboard = function() {
        console.log("Refreshing dashboard via Partial Update...");
        $("#dashboardContainer").css("opacity", "0.5"); // Visual feedback
        
        const url = "/Home/DashboardPartial?t=" + new Date().getTime();
        $("#dashboardContainer").load(url, function(response, status, xhr) {
            $("#dashboardContainer").css("opacity", "1");
            if (status == "error") {
                console.error("Error reloading dashboard: " + xhr.status + " " + xhr.statusText);
            } else {
                console.log("Dashboard refreshed successfully! [" + new Date().toLocaleTimeString() + "]");
            }
        });
    }

</script>
